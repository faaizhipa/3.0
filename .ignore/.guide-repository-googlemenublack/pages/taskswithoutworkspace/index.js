"use strict";!function(){function a(e,a){var c=a.indexOf(e);return a.slice(Math.max(0,c+e.length))}function c(e,a){e=a.lastIndexOf(e);return a.slice(0,Math.max(0,e))}function x(e){e=a("AF_initDataCallback({key: 'ds:1'",e),e=c("sideChannel:",a(" data:",e)),e=c("]",e)+"]",e=JSON.parse(e);return(e[5]||e[8]).map(function(e){return{id:"room/"+e[0][1],label:e[2]}})}cjce.registerTemplate("bm-p-taskswithoutworkspace",function(e,c){var t,n,i,a,s,o,r,l="https://tasks.google.com",d=c.wizPath+"/embed/",m=cjgFrontend.companion.getInitData(),_=m.id,h=m.hash,u=m.parameters,m=cjBasics.generateUniqueId(),b=cjBasics.lang.i18n("cj_i18n_06917","My Tasks"),g="list/~default",p="list/~starred",j=g,f=[{id:g,label:b}],v=[],k="",w={bm_cid:"taskswithcompanion",bm_cst:"1",bm_iid:m,bm_wiz:"1",bm_udm:c.darkMode?"1":null,fullWidth:"1",hl:cjBasics.lang.getCurrent()};function C(e){var a=l+c.wizPath+"/tasks/";e&&-1!==e.indexOf("starred")&&(a+=p),c.openTab(a)}function T(e){e=e&&e.label||b;t.cjceSetPageLabel(e)}function B(){a=[{iconName:"__mdi_gm_hybrid:cjh_star",id:p,label:cjBasics.lang.i18n("cj_i18n_00004","Starred"),newTabUrl:!0}],f.forEach(function(e){e.iconName="__mdi_todo:list_alt",e.newTabUrl=!0,e.id===j&&T(e),a.push(e)}),Array.isArray(v)&&0<v.length&&(a.push({color:!0,header:!0,label:cjBasics.lang.i18n("cj_i18n_06918","Rooms")}),v.forEach(function(e){e.iconName="__mdi_todo:group",e.newTabUrl=!0,e.id===j&&T(e),a.push(e)}));var a,e=a,c=JSON.stringify(e.map(function(e){return[e.id,e.label]}));c!==k&&(k=c,c=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:j,items:e,onChange:function(e,a){t.cjceSetLoading(!0),T(a);a=e.startsWith("room/")||e.startsWith("space/"),i.hidden=a,a=cjBasics.urlParams.attach(d+e,w);n.src=l+a},onNewTab:function(e){C(e)}}),t.cjceDrawerEl.textContent="",t.cjceDrawerEl.appendChild(c))}function A(e){n.cjceSendFrameCommand({method:"bmCstClickDomElement",value:e},l)}function E(){A('body > div > c-wiz > div[role="menu"] div[role="separator"] + [aria-label][role="menuitem"]')}function I(){A("h2 + div > div:first-child[data-allow-task-list-reordering] > div"),setTimeout(E),setTimeout(E,10),setTimeout(E,50),setTimeout(E,100),setTimeout(E,200),setTimeout(E,300),setTimeout(E,500)}function y(){A("div>button")}function N(){A('div[data-menu-corner="top-end"][data-anchor-corner="bottom-end"]')}Object.keys(u).forEach(function(e){w[e]=u[e]}),t=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"tasks",bmApis:c,onNewTab:function(){C(j)},serviceLabel:cjBasics.lang.i18n("cj_i18n_00439","Tasks"),pageLabel:b}),e.appendChild(t),i=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_gm:date_range",label:cjBasics.lang.i18n("cj_i18n_00302","Calendar"),onClick:function(){c.pageManager.navigate("calendar")},onMetaClick:function(){var e="https://calendar.google.com/calendar/u/"+c.account.authuser+"/r";c.openTab(e)}}),t.cjceAppendChild(i),s=cjce.createElement("ccbm-iconbutton",{iconName:cjBasics.navigator.isSafari?"__mdi_todo:more_horiz":"__mdi_todo:more_vert",label:cjBasics.lang.i18n("cj_i18n_06294","More actions"),onClick:N}),t.cjceAppendChild(s),s.parentNode.appendChild(s),cjBasics.webRequest.handleIframeHeaders([l+"/*bm_iid="+m+"*"],{handleFirefoxInject:!0,handleSwCache:!0}),r=o=!1,a="https://chat.google.com"+c.wizPath+"/",cjBasics.ajax(a+"?shell=9").then(x).catch(function(){return cjBasics.ajax(a+"?shell=8").then(x)}).catch(function(){return[]}).then(function(e){r=!0,0<e.length&&cjgApis.cache.setItem(c.account,"bm_cache_v36__tasks__spaces",e),v=e,B()}),Promise.all([cjgApis.cache.getItem(c.account,"bm_cache_v36__tasks__activeview"),cjgApis.cache.getItem(c.account,"bm_cache_v36__tasks__tasklists"),cjgApis.cache.getItem(c.account,"bm_cache_v36__tasks__spaces")]).then(function(e){e[0]&&(j=e[0]);var a=e[1],a=(!o&&Array.isArray(a)&&0<a.length&&(f=a),e[2]);!r&&Array.isArray(a)&&0<a.length&&(v=a),B()}),s=cjBasics.urlParams.attach(l+d+"list/",w)+h,n=cjce.createElement("bm-iframe",{src:s,solid:!0,shadow:!0,sandbox:"allow-scripts allow-forms allow-same-origin allow-popups",onLoad:function(){t.cjceSetLoading(!1)},onBmMessage:function(e,a){"taskswithcompanionData"===e&&(o=!0,j=(e=a).activeView||g,0<(e=e.tasklists).length&&(f=e,cjgApis.cache.setItem(c.account,"bm_cache_v36__tasks__tasklists",f)),j.startsWith("list/")&&cjgApis.cache.setItem(c.account,"bm_cache_v36__tasks__activeview",j),B())},onMessage:function(e){e=cjgFrontend.companion.handleOpenUrlMessage(e,_,c.account);e&&c.openTab(e)}}),e.appendChild(n),s=cjce.createElement("ccbm-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_06336","New task"),onClick:y}),cjce.createElement("ccbm-fab",{mini:!0,iconName:"__mdi_todo:post_add",label:cjBasics.lang.i18n("cj_i18n_06919","Create a new list"),onClick:I})]}),e.appendChild(s)})}();