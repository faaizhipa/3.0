"use strict";!function(){var x=window,N=document,z="undefined"!=typeof chrome&&chrome||{},P="undefined"!=typeof KeyboardEvent&&"key"in KeyboardEvent.prototype&&!/MSIE |Edge\/|Trident.*rv:11\./.test(navigator.userAgent)&&void 0===String.quote,D=P?" ":32,M=P?"Enter":13,T=P?"ArrowUp":38,I=P?"ArrowDown":40;var e=z.runtime.getURL("PATH/").replace("/PATH/",""),K=!e.startsWith("safari-web-extension://")&&e.startsWith("moz-extension://");function O(){return"open"in(z.sidePanel||"object"==typeof browser&&browser.sidebarAction||z.sidebarAction||"object"==typeof opr&&opr.sidebarAction||{})}cjce.registerTemplate("bm-p-portal",function(e,i){e.classList.add("bm-p-portal");var c,o=[],r="",s="search",d=!1;function l(e,t,n){e=(e=e).shortcutId&&cjgFrontend.urls.getShortcutUrl(e.shortcutId,i.account)||e.url;i.openTab(e,t,n)}i.darkMode&&e.style.setProperty("--background-color","#2d2d2d");var p={},m={};function u(t,e){var n=i.servicesDatabase[t],a=n.iconName||"placeholder",c=(i.darkMode&&"googleg"===a&&(a="search"),cjce.createElement("cjmd-item",{icon:{serviceName:a},label:n.label}));return c.classList.add("bm-p-portal-pageitem"),c.dataset.id=t,c.tabIndex=0,c.style.setProperty("--ccc-accent-color",(a=n.color)?!0===a?i.darkMode?"#669df6":"#1a73e8":a:i.darkMode?"rgba(255, 255, 255, 0.8)":"#212121"),e?(c.draggable=!0,(a=cjce.createElement("cjmd-icon",{name:"__mdi_todo:drag_indicator",size:20})).classList.add("bm-p-portal-pageitem__dragicon"),c.appendChild(a),(e=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_todo:delete",label:cjBasics.lang.i18n("cj_i18n_01164","Remove from menu"),onClick:function(e){i.userServices.remove(t),c.remove(),r=r.replace("_"+t+"_","_"),e.stopPropagation()}})).classList.add("bm-p-portal-pageitem__remove"),c.appendChild(e)):(n.shortcutId||n.url)&&((a=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_todo:open_in_new",label:cjBasics.lang.i18n("cj_i18n_00084","Open service in new tab"),onClick:function(e){var t=cjBasics.hasMetaKey(e);l(n,e.shiftKey,t),e.stopPropagation()}})).classList.add("bm-p-portal-pageitem__open-in-new"),c.appendChild(a)),c}function g(e){j(e===s?i.userServices.getLastUsedNonToolsPage():e)}function t(){var e=cjce.createElement("cjmd-appbar"),t=cjce.createElement("ccbm-button",{label:cjBasics.lang.i18n("cj_i18n_01188","Pages"),outline:!0,onClick:function(){j("portal")}});e.appendChild(t),t.classList.add("bm-p-portal-switcher");var n,a=cjce.createElement("cjmd-icon",{name:"__mdi_todo:keyboard_arrow_down"}).firstElementChild,a=(a.classList.add("ccc-icon","ccc-button__icon"),t.insertBefore(a,t.firstChild),cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_gm_hybrid:apps",label:cjBasics.lang.i18n("cj_i18n_00216","Apps"),onClick:function(){g("applauncher")}})),t=(a.classList.add("bm-p-portal-pageicon"),p.applauncher=a,e.appendChild(a),cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_gm_hybrid:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),onClick:function(){g("extensionsettings")}}));return t.classList.add("bm-p-portal-pageicon"),p.extensionsettings=t,e.appendChild(t),i.account.validSession?("sidebar"===i.environment?K||(a=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_todo:cjg_extension_popup",onClick:function(){z.runtime.sendMessage({method:"openActionPopup"}),x.close()}}),e.insertBefore(a,t)):O()?(a=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_todo:right_panel_open",onClick:function(){!function(){if(z.sidePanel)return z.windows.getCurrent().then(function(e){e=e.id;return z.sidePanel.open({windowId:e})});try{return browser.sidebarAction.open()}catch(e){}return new Promise(function(e){(z.sidebarAction||opr.sidebarAction).open(e)})}().then(function(){x.close()})}}),e.insertBefore(a,t)):((a=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_todo:notifications",label:cjBasics.lang.i18n("cj_i18n_00296","Notifications"),onClick:function(){g("notifications")}})).classList.add("bm-p-portal-pageicon"),p.notifications=a,e.insertBefore(a,t)),a=i.account.displayName,i.account.pageId&&(a+="\n"+cjBasics.lang.i18n("cj_i18n_00363","Brand account")),i.account.displayEmail&&(a+="\n"+i.account.displayEmail),n=cjce.createElement("ccbm-iconbutton",{label:a,icon:{size:32,avatar:!0,url:cjgFrontend.urls.getAvatar(i.account.photoUrl,32)},onClick:function(){g("accountchooser")}}),(p.accountchooser=n).classList.add("bm-p-portal-pageicon"),e.appendChild(n),cjgApis.info.getIsOne(i.account).then(function(e){e&&n.classList.add("bm-p-portal-accountbutton--one")})):((t=cjce.createElement("ccbm-button",{label:cjBasics.lang.i18n("cj_i18n_01544","Sign in"),fill:!0,color:!0,onClick:function(){cjgApis.account.signin(i.account)}})).classList.add("bm-p-portal-signin"),e.appendChild(t)),e}function f(e){var t=c.scrollTop,e=e.offsetTop,n=e-60;(n<t||t<(n=e-c.offsetHeight-4))&&(c.scrollTop=n)}function b(){var n=!i.account.pageId&&d,a=N.createDocumentFragment(),e=((o||[]).forEach(function(e){var t;i.servicesDatabase[e]&&(t=u(e,n),m[e]=t,a.appendChild(t))}),m[s]);e&&e.classList.add("cjmd-item--selected"),c.textContent="",c.appendChild(a),e&&f(e)}function n(e){var t=o.indexOf(s);j(o[t+(e?-1:1)]||(e?o[o.length-1]:o[0]))}function _(){"removedialog"===s&&j("customize")}function v(e){e.preventDefault()}function h(e){e.preventDefault();var t=e.dataTransfer.getData("serviceId"),n=e.target,a=n,e=(a=24<e.offsetY&&n.nextSibling?n.nextSibling:a).dataset.id,a=o.indexOf(e);n===c||-1===a?i.userServices.add(t):(-1!==(e=o.indexOf(t))&&o.splice(e,1),o.splice(a,0,t),i.userServices.set(o)),_()}function j(e){var t;"customize"===e&&0===o.length&&(t={welcome:!0}),i.pageManager.navigate(e,t)}function E(e){j("removedialog"),e.dataTransfer.setData("serviceId",e.target.dataset.id)}i.darkMode&&e.classList.add("cjmd--dark");var a=t();function C(e){var t,n,a;e!==s&&((t=p[n=s])?t.setAttribute("aria-selected","false"):(t=m[n])&&t.classList.remove("cjmd-item--selected"),(n="customize"===(s=e)||"removedialog"===e)!==d?(d=n,b(),c.classList.toggle("bm-p-portal-pagelist--customize",d),a=d,setTimeout(function(){L.classList.toggle("bm-p-portal-customize--finish",a),k.hidden=a,w.hidden=!a,y||(B.textContent=a?S:A),a?(x.addEventListener("dragend",_),c.addEventListener("dragover",v),c.addEventListener("drop",h),c.addEventListener("dragstart",E)):(x.removeEventListener("dragend",_),c.removeEventListener("dragover",v),c.removeEventListener("drop",h),c.removeEventListener("dragstart",E))})):(t=p[e])?t.setAttribute("aria-selected","true"):(n=m[e])&&(n.classList.add("cjmd-item--selected"),f(n)))}e.appendChild(a),(c=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"transparentOnScroll"})).setAttribute("role","navigation"),c.addEventListener("click",function(e){var t,n=e.target.dataset.id;n&&(t=e.shiftKey,e=cjBasics.hasMetaKey(e),t||e?l(i.servicesDatabase[n],t,e):j(n))}),c.addEventListener("pointerdown",function(e){e=e.target.dataset.id;e&&i.loadPage(e)}),c.addEventListener("auxclick",function(e){var t;1===e.button&&(t=e.target.dataset.id)&&(l(i.servicesDatabase[t],e.shiftKey,!0),e.preventDefault())}),c.addEventListener("keydown",function(e){t=e;var t=P&&t.key||t.which||t.keyCode,n=e.shiftKey,a=cjBasics.hasMetaKey(e);if(n||a)return t===M&&(c=e.target.dataset.id)?void l(i.servicesDatabase[c],n,a):void 0;var c=N.activeElement;if(t===T)(c.previousElementSibling||c.parentNode.lastElementChild).focus();else if(t===I)(c.nextElementSibling||c.parentNode.firstElementChild).focus();else{if(t!==M&&t!==D)return;c.click()}e.preventDefault()}),i.userServices.onChange(function(e){var t="_"+e.join("_")+"_";r!==t&&(o=e,r=t,b())}),i.pageManager.onChange(function(e){C(e)}),e.appendChild(c);var L=N.createElement("div"),y=(L.className="bm-p-portal-page bm-p-portal-customize",Boolean(i.account.pageId)),k=(L.dataset.id=y?"accountchooser":"customize",cjce.createElement("cjmd-icon",{name:y?"__mdi_todo:account_circle":"__mdi_todo:edit",color:i.darkMode?null:"#5f6368"})),w=(k.classList.add("bm-p-portal-customize__icon"),L.appendChild(k),cjce.createElement("cjmd-icon",{name:"__mdi_todo:done"})),B=(w.hidden=!0,w.classList.add("bm-p-portal-customize__icon"),L.appendChild(w),N.createElement("div")),A=cjBasics.lang.i18n("cj_i18n_01713","Customize"),a=cjBasics.lang.i18n("cj_i18n_01543","Switch account"),S=cjBasics.lang.i18n("cj_i18n_05492","Done");B.textContent=y?a:A,B.className="bm-p-portal-customize__label",L.appendChild(B),L.addEventListener("click",function(){var e=y?"accountchooser":d?i.userServices.getLastUsedNonToolsPage():"customize";j(e)}),e.appendChild(L);try{z.commands.onCommand.addListener(function(e){"portal-next-page"===e?n(!1):"portal-previous-page"===e&&n(!0)})}catch(e){}})}();