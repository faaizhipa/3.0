"use strict";!function(){var J=document,W=cjBasics.getUnifiedStorageItem("bm_pref__contacts__lastname");function Y(e){return Array.isArray(e)&&0!==e.length?e:null}function K(e,t,a){return"string"!=typeof e?"/images/avatar.svg":((e=e.startsWith("http://")?e.replace("http://","https://"):e).startsWith("https://www.google.com/s2/")&&(e=e.replace("www","profiles")),cjgFrontend.urls.getAvatar(e,t,a))}cjce.registerTemplate("bm-p-contactswithgapi",function(o,r){var s,l,d,m,u,i,e,p="https://contacts.google.com"+r.wizPath+"/",O="https://people.googleapis.com/v1/",x="https://www.google.com/m8/feeds/",n=["https://www.googleapis.com/auth/contacts.readonly"],c=40,t=window.devicePixelRatio||2,F=Math.ceil(c*t),h=p,_="home",b=null,D=25,R=["contactGroups/coworkers","contactGroups/family","contactGroups/friends"],f=!1,a=W.then(function(e){f=Boolean(e)}),g="connections(resourceName,names(displayName,displayNameLastFirst),photos/url,memberships/contactGroupMembership/contactGroupId),nextPageToken",j=null,C=!1,y=function(){if(cjgApis.info.getIsConsumerGmail(r.account))return Promise.resolve(!1);return cjgApis.cache.getItem(r.account,"bm_pref__contacts__directory").then(function(e){return"boolean"==typeof e?e:w().then(function(){return!0},function(){return!1}).then(function(e){return cjgApis.cache.setItem(r.account,"bm_pref__contacts__directory",e),e})})}().then(function(e){e&&(C=!0,g=g.replace("resourceName,","resourceName,metadata/sources(type,id),"))}),v=!1,N={};function q(){return cjgApis.info.getUserDomain(r.account).then(function(e){e=cjBasics.urlParams.attach(x+"gal/"+(e||"default")+"/full",{alt:"json","max-results":"50000"});return cjgApis.request(e,{fetchAs:"json",headers:{"GData-Version":"1.0"}},{account:r.account,requiredScopes:n})}).then(function(e){var i=[],e=e&&e.feed&&e.feed.entry;return Array.isArray(e)&&e.forEach(function(e){var t,a,n,c=function(e){if(!(e=e.id&&e.id.$t&&e.id.$t.split("full/P.")[1]))return null;for(var t=cjBasics.hex2dec(e);t.length<20;)t="0"+t;return t=t.length<21?"1"+t:t}(e);c&&(t=c="people/"+c,(e=(e=e).gd$name)&&(a=e.gd$fullName&&e.gd$fullName.$t,n=e.gd$givenName&&e.gd$givenName.$t,e=e.gd$familyName&&e.gd$familyName.$t,N[t]={displayName:a||n||e,displayNameLastFirst:e&&n?e+", "+n:null}),i.push(c))}),i})}function w(){return j=j||q()}function E(e){var t=function(e){var t=e.resourceName;if(C&&t.startsWith("people/c")){var a=e.metadata&&e.metadata.sources;if(Array.isArray(a))for(var n=0;n<a.length;n++)if("DOMAIN_PROFILE"===a[n].type)return"people/"+a[n].id}return t}(e),a=e&&e.names&&e.names[0]||N[t];if(a){var n,c=a.displayName||"",a=a.displayNameLastFirst||c;if(c)return n=[],Array.isArray(e.memberships)&&(n=e.memberships.map(function(e){return e.contactGroupMembership?e.contactGroupMembership.contactGroupId:"GSUITE_DIRECTORY_GROUP"})),{id:t,displayName:c,displayNameLastFirst:a,sortValue:c.toLowerCase(),sortValueLastFirst:a.toLowerCase(),photo:e.photos&&e.photos[0].url||null,memberships:n}}}function $(e){for(var t=[],a=[],n=0;n<e.length;n+=50){var c=L("people:batchGet",{resourceNames:e.splice(0,50),fields:"responses(requestedResourceName,person(names(displayName,displayNameLastFirst),photos/url,memberships/contactGroupMembership/contactGroupId))",personFields:"names,photos,memberships"}).then(function(e){e.responses.forEach(function(e){e.person.resourceName=e.requestedResourceName;e=E(e.person);e&&t.push(e)})});a.push(c)}return Promise.all(a).then(function(){return t})}function T(e,t){u.cjceSetLoading(!0),_=e,b=t,v&&k()}function S(e){var a=f?"sortValueLastFirst":"sortValue";e.sort(function(e,t){return e[a]<t[a]?-1:1})}function M(){Promise.all([cjgApis.cache.getItem(r.account,"bm_cache_v36__contacts__library"),a]).then(function(e){v||(s=e[0])&&(v=!0,k())}),Promise.all([y,a]).then(function(e){var t=function(e,t,a,n){var c=a||[];a="other"===e?"otherContacts":"people/me/connections";return L(a,{pageToken:n,pageSize:"2000",personFields:"memberships,metadata,names,photos",fields:g,sortOrder:t}).then(function(e){return Array.isArray(e.connections)&&(e.connections.forEach(function(e){e=E(e);e&&c.push(e)}),e.nextPageToken,0),c})}("main",f?"LAST_NAME_ASCENDING":"FIRST_NAME_ASCENDING");return C?Promise.all([w().then($),t]).then(function(e){var t=e[0],e=e[1],a=t.map(function(e){return e.id});return e.forEach(function(e){-1===a.indexOf(e.id)&&t.push(e)}),S(t),t}):t}).then(function(e){v=!0,s&&JSON.stringify(s).length===JSON.stringify(e).length||(cjgApis.cache.setItem(r.account,"bm_cache_v36__contacts__library",e),s=e,k())})}function L(t,a){var e=a||{},e=(e.prettyPrint="false",cjBasics.urlParams.attach(O+t,e));return cjgApis.request(e,{fetchAs:"json"},{account:r.account,requiredScopes:n}).catch(function(){return new Promise(function(e){setTimeout(function(){L(t,a).then(e)},4e3)})})}function B(){return cjce.createElement("ccbm-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_01285","Create contact"),onClick:function(){r.openTab(p+"new")}})]})}function A(e,t){e=p+e.replace("people/","person/");t&&(e+="?edit=true"),r.openTab(e)}function I(t){return s.filter(function(e){return-1!==e.memberships.indexOf(t)})}function G(e,t){var n=J.createDocumentFragment();t.forEach(function(e){t=e,e=f&&t.displayNameLastFirst||t.displayName,a={size:c},t.photo?(a.url=K(t.photo,0,F),a.avatar=!0):(a.withShell=!0,a.symbol=e[0]||"-"),(a=cjce.createElement("cjmd-item",{icon:a,label:e})).classList.add("bm-p-contactswithgapi-listitem"),a.cjceContactsData=t,(e=cjce.createElement("ccbm-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_06290","Edit contact"),iconName:"__mdi_todo:edit",onClick:function(){A(t.id,!0)}})).classList.add("bm-p-contactswithgapi-listitem__tool"),a.appendChild(e),(e=cjce.createElement("ccbm-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_01545","Open in a new tab"),iconName:"__mdi_todo:open_in_new",onClick:function(){A(t.id)}})).classList.add("bm-p-contactswithgapi-listitem__tool"),a.appendChild(e);var t,a,e=a;n.appendChild(e)}),e.appendChild(n)}function k(){u.cjceSetLoading(!0);var a,t,n,e,c,i=cjce.createElement("cjmd-container",{scrollable:!0,fabPadding:!0,infiniteScroll:!0,shadow:"thinOnScroll"});"home"===_?(0<(e=I("starred")).length&&(c=cjce.createElement("cjmd-subheader",{color:!0,label:cjBasics.lang.i18n("cj_i18n_00004","Starred")}),i.appendChild(c),G(c=cjce.createElement("cjmd-list"),e),i.appendChild(c),e=cjce.createElement("cjmd-subheader",{color:!0,label:cjBasics.lang.i18n("cj_i18n_00314","Contacts")}),i.appendChild(e)),a=I("myContacts")):"search"===_?(t=b,a=s.filter(function(e){return-1!==JSON.stringify(e).indexOf(t)})):"directory"===_?a=I("GSUITE_DIRECTORY_GROUP"):"other"===_?a=I("SPECIAL_OTHER"):"label"===_&&(a=I(b)),0<a.length?(n=cjce.createElement("cjmd-list"),function e(){var t=a.splice(0,D);G(n,t),0!==a.length&&setTimeout(function(){i.cjceSetInfiniteScroll(e)})}(),i.appendChild(n)):(c=_,e=cjce.createElement("cjmd-emptystate",{color:!0,label:cjBasics.lang.i18n("cj_i18n_01275","No contacts found"),subLabel:"search"===c?cjBasics.lang.i18n("cj_i18n_00116","Try a synonym or more general keyword"):null,iconName:"search"===c?"__mdi_todo:search":"__mdi_todo:contacts_product"}),i.appendChild(e)),d.textContent="",d.appendChild(i),u.cjceSetLoading(!1)}function P(e,t){var a=t.resourceName.replace("contactGroups/",""),n=t.formattedName,c=n,t=t.memberCount;0<t&&(c+=" ("+t+")"),e.push({id:a,iconName:"__mdi_todo:label",label:c,navigatorLabel:n,newTabUrl:p+"label/"+a})}function V(){cjce.applyTemplate(m,"bm-loading");var n=[{id:"home",iconName:"__mdi_todo:person",label:cjBasics.lang.i18n("cj_i18n_00314","Contacts"),navigatorLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),newTabUrl:p},{iconName:"__mdi_todo:history",label:cjBasics.lang.i18n("cj_i18n_01276","Frequently contacted"),newTabUrl:p+"frequent",external:!0},{iconName:"__mdi_todo:archive",label:cjBasics.lang.i18n("cj_i18n_01278","Other contacts"),newTabUrl:p+"other",divider:!0}],c=[{iconName:"__mdi_todo:assistant",label:cjBasics.lang.i18n("cj_i18n_01277","Duplicates"),newTabUrl:p+"suggestions",external:!0},{iconName:"__mdi_todo:delete",label:cjBasics.lang.i18n("cj_i18n_00005","Trash"),newTabUrl:p+"trash",external:!0,divider:!0}],i=J.createElement("div"),e=(m.appendChild(i),L("contactGroups",{pageSize:"500",fields:"contactGroups(resourceName,groupType,formattedName,memberCount)"}));Promise.all([e,a,y]).then(function(e){var a=[],t=(C&&(n[0].divider=!1,n.push({id:"directory",label:cjBasics.lang.i18n("cj_i18n_01279","Directory"),iconName:"__mdi_todo:business",newTabUrl:p+"directory",divider:!0})),e[0].contactGroups.forEach(function(e){var t;"USER_CONTACT_GROUP"===e.groupType?P(a,e):"contactGroups/myContacts"===e.resourceName?0<(t=e.memberCount)&&(n[0].label+=" ("+t+")"):-1!==R.indexOf(e.resourceName)&&0<e.memberCount&&P(a,e)}),0<a.length&&(n.push({header:!0,label:cjBasics.lang.i18n("cj_i18n_01280","Labels")}),a.sort(function(e,t){return e.label.toLowerCase()<t.label.toLowerCase()?-1:1}),a[a.length-1].divider=!0,n=n.concat(a)),n=n.concat(c),l=cjce.createElement("bm-navlist",{compact:!0,isSelector:!0,selectedId:"home",items:n,onChange:function(e,t){h=t.newTabUrl||p,"home"===e||"directory"===e||"other"===e?T(e):T("label",e),u.cjceSetPageLabel(t.navigatorLabel||t.label)},onNewTab:function(e,t){r.openTab(t.newTabUrl)}}),i.appendChild(l),cjce.createElement("bm-drawerdropdown",{iconName:"__mdi_todo:cj_sort_by_alpha",label:cjBasics.lang.i18n("cj_i18n_01281","Sort"),selectedId:f?"last":"first",items:[{value:"last",label:cjBasics.lang.i18n("cj_i18n_01282","Sort by last name")},{value:"first",label:cjBasics.lang.i18n("cj_i18n_01283","Sort by first name")}],onChange:function(){var e;e="last"===t.cjceSelectedId,f=e,cjBasics.setUnifiedStorageItem("bm_pref__contacts__lastname",f),v&&(S(s),k())}}));m.appendChild(t),m.cjceSetLoading(!1)})}function U(t){var e=cjce.createElement("cjmd-item"),a=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi_gm:content_copy",label:cjBasics.lang.i18n("cj_i18n_07125","Copy to clipboard"),onClick:function(e){cjBasics.copyToClipboard(t.value),i||(i=cjce.createElement("ccbm-snackbar",{label:cjBasics.lang.i18n("cj_i18n_07124","Copied to clipboard")}),o.appendChild(i)),i.cjceShow()}}),n=(t.onClick?e.addEventListener("click",function(e){e=e.target;e===a||a.contains(e)||t.onClick()}):e.classList.add("no-action"),cjce.createElement("cjmd-icon",{name:t.iconName})),n=(e.appendChild(n),J.createElement("div")),c=(n.className="cjmd-item__body",e.appendChild(n),J.createElement("div"));return c.className="cjmd-item__header",c.textContent=t.value,n.appendChild(c),t.subLabel&&(c=cjce.createElement("cjmd-secondarytext",{label:t.subLabel}),n.appendChild(c)),e.appendChild(a),e}function z(e){e=encodeURIComponent(e);r.openTab(p+"search/"+e)}function H(){var e=l.cjceSelectedId;"home"===e||"directory"===e||"other"===e?T(e):T("label",e)}u=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"contacts",serviceLabel:cjBasics.lang.i18n("cj_i18n_00314","Contacts"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),searchbox:{color:!0,onClear:H,onInput:function(e){e?T("search",e):H()},onSubmit:function(){d.querySelector(".cjmd-item").click()},onMetaSubmit:z},bmApis:r,onNewTab:function(){"search"===_?z(b):r.openTab(h)}}),o.appendChild(u),m=u.cjceDrawerEl,t=u.cjceSearchboxEl,e=B(),o.appendChild(e),r.setOnPageDisplayHandler(t.select),(d=cjce.createElement("cjmd-container")).addEventListener("click",function(e){var t,a,c,n,i,e=e.target.cjceContactsData;e&&(t=e,(a=cjce.createElement("cjmd-container",{solid:!0})).classList.add("bm-p-contactswithgapi-details"),e=cjce.createElement("bm-ogb",{floating:!0,displayBack:!0,onBack:function(){a.remove()},bmApis:r,onNewTab:function(){A(t.id)}}),a.appendChild(e),n=cjce.createElement("ccbm-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_06290","Edit contact"),iconName:"__mdi_todo:edit",onClick:function(){A(t.id,!0)}}),e.cjceAppendChild(n),(c=J.createElement("div")).className="bm-p-contactswithgapi-details__top",a.appendChild(c),e=f&&t.displayNameLastFirst||t.displayName,n={size:80},t.photo?(n.url=K(t.photo,80),n.avatar=!0):(n.symbol=e[0]||"-",n.withShell=!0),(n=cjce.createElement("cjmd-icon",n)).classList.add("bm-p-contactswithgapi-details__photo"),c.appendChild(n),(n=cjce.createElement("cjmd-title",{label:e})).classList.add("bm-p-contactswithgapi-details__name"),c.appendChild(n),e=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thickOnScroll"}),a.appendChild(e),i=cjce.createElement("cjmd-list"),e.appendChild(i),L(t.id,{fields:"addresses,birthdays,emailAddresses,phoneNumbers"}).then(function(e){var a=J.createDocumentFragment(),t=Y(e.emailAddresses),n=(t&&t.forEach(function(e){var t=U({iconName:"__mdi_todo:email",value:e.value,subLabel:e.formattedType,onClick:function(){r.openTab("mailto:"+e.value)}});a.appendChild(t)}),Y(e.phoneNumbers));n&&n.forEach(function(e){var t=U({iconName:"__mdi_todo:call",value:e.value,subLabel:e.formattedType,onClick:function(){r.openTab("tel:"+e.canonicalForm)}});a.appendChild(t)}),t&&(n=t[0].value,t=[{iconName:"__mdi_todo:email",label:cjBasics.lang.i18n("cj_i18n_07233","Send email"),newTabUrl:"mailto:"+n},{iconName:"__mdi_todo:event",label:cjBasics.lang.i18n("cj_i18n_07234","Schedule event"),newTabUrl:cjBasics.urlParams.attach("https://meet.google.com/new",{authuser:"0"===r.account.authuser?null:r.account.authuser,calleeId:n})},{iconName:"__mdi_todo:meet",label:cjBasics.lang.i18n("cj_i18n_07235","Start video call"),newTabUrl:cjBasics.urlParams.attach("https://calendar.google.com/calendar/r/eventedit",{authuser:"0"===r.account.authuser?null:r.account.authuser,add:n})}],n=cjce.createElement("ccbm-biglinks",{bottom:!0,items:t,onClick:function(e,t){t=t.newTabUrl;r.openTab(t)}}),c.appendChild(n)),Array.isArray(e.addresses)&&0<e.addresses.length&&e.addresses.forEach(function(e){var t=U({iconName:"__mdi_todo:place",value:e.formattedValue,subLabel:e.formattedType,onClick:function(){r.openTab(cjBasics.urlParams.attach("https://maps.google.com/",{authuser:"0"===r.account.authuser?null:r.account.authuser,q:e.formattedValue}))}});a.appendChild(t)}),Array.isArray(e.birthdays)&&0<e.birthdays.length&&e.birthdays.forEach(function(e){e=U({iconName:"__mdi_todo:cake",value:e.text});a.appendChild(e)}),0===a.children.length&&((t=J.createElement("div")).className="bm-p-contactswithgapi-noinfo",t.textContent=cjBasics.lang.i18n("cj_i18n_01284","No more contact info found"),a.appendChild(t)),i.appendChild(a),u.cjceSetLoading(!1)}),o.appendChild(a))}),o.appendChild(d),M(),V(),cjgApis.auth.requireToken(r.account,n).catch(function(e){var t=cjce.createElement("bm-fulldialog",{bmApis:r,onNewTab:function(){r.openTab(h)},lockup:{label:cjBasics.lang.i18n("cj_i18n_00314","Contacts")},iconName:"contacts",message:cjBasics.lang.i18n("cj_i18n_01286","Before you can use this page, you need to give access to load your Google Contacts"),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(r.account,e.cjg_missing_scopes)}}),a=B();t.appendChild(a),o.appendChild(t)})})}();