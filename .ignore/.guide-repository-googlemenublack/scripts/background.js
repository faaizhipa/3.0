"use strict";!function(){var n=self,u=n.location,p="undefined"!=typeof chrome&&chrome||{},t=p.runtime.getURL("PATH/").replace("/PATH/",""),m=t.startsWith("safari-web-extension://"),l=!m&&t.startsWith("moz-extension://"),f=!m&&!l;function b(e,r){return new Promise(function(t,n){p.notifications.create(e,r,function(){var e=p.runtime.lastError;e?n(e):t()})})}var e=p.sidebarAction||"object"==typeof opr&&opr.sidebarAction,g=p.action||p.browserAction||p.pageAction||e;function r(t){return new Promise(function(n,r){function e(e){var t=p.runtime.lastError;t?r(t):n(e)}t?g.openPopup(t,e):g.openPopup(e)})}function R(e){if(!m&&navigator.userAgent.includes(" Mobile"))return Promise.reject(new Error("API unsupported"));if(l){var t=browser.action||browser.browserAction||browser.pageAction;if(!t.openPopup)return Promise.reject(new Error("API missing"));if(e)try{return t.openPopup(e)}catch(e){}return t.openPopup()}return e?r(e).catch(function(){return r()}):r()}function h(e){g.setPopup({popup:e})}function S(){var e;h(l?null:((e=p.runtime.getManifest()).action||e.browser_action||e.page_action||{}).default_popup||"")}var _=p.tabs&&p.tabs.TAB_ID_NONE||-1;function d(e){return"number"==typeof(e=e&&e.id)?e:_}function F(){return i={active:!0,currentWindow:!0},new Promise(function(n,r){p.tabs.query(i,function(e){var t=p.runtime.lastError;t?r(t):Array.isArray(e)?m&&i&&i.url?(t=e.filter(function(e){return e.url}),n(t)):n(e):r(new Error("No array returned"))}),setTimeout(n,2e3)}).then(function(e){return e[0]},function(){return null});var i}function v(e,t){return new Promise(function(n,r){p.tabs.update(e,t,function(e){var t=p.runtime.lastError;t?r(t):n(e)})})}function o(e){return new Promise(function(n,r){p.windows.create(e,function(e){var t=p.runtime.lastError;t?r(t):n(e)})})}function s(o){return new Promise(function(n,r){function i(e){var t=e.message||"";"openerTabId"in o&&-1!==t.indexOf("openerTabId")?(delete o.openerTabId,n(s(o))):f&&-1!==t.indexOf("Saved groups are not editable")?n():r(e)}try{p.tabs.create(o,function(e){var t=p.runtime.lastError;t?i(t):n(e)})}catch(e){i(e)}})}function i(e){n.open(e,"_blank","noopener")}function a(t){try{n.top.location.href=t}catch(e){i(t)}}function c(t,e){var n="number"==typeof(e=e)&&e!==_?e:null;return v(n,{url:t}).catch(function(){if(null===n)return F().then(function(e){e=d(e);if(e!==_)return c(t,e);a(t)});a(t)})}function N(e,t,n,o){var r={url:e},a=(!1===t&&n&&(r.active=!1),d(o));return a!==_&&(r.openerTabId=a,r.index=o.index+1),s(r).then(function(e){var t,n,r,i;return a!==_&&(t=e,n=o,p.tabs.group)&&(r=d(t))!==_&&(i=n.groupId,t.groupId!==i)&&p.tabs.group({groupId:i,tabIds:r},function(){p.runtime.lastError||(t.groupId=i)}),e},function(){i(e)})}function w(e,t,n,r,i){if(!e)return Promise.reject(new Error("Missing URL"));if(!n){if(t)return o({incognito:Boolean(r&&r.incognito),url:e}).catch(function(){return N(e,t,n,r)});if(!1===n)return c(e,i)}return N(e,t,n,r)}var W,V=!0;try{var y=p.i18n.getMessage("@@ui_locale");"string"==typeof y&&"und"!==y&&(W=y.replace("_","-"))}catch(e){V=!1}if(!W)try{var q=p.runtime.getManifest().default_locale;"string"==typeof q&&q.replace("_","-")}catch(e){}function P(e,t){return e&&V&&p.i18n.getMessage(e)||t||""}function D(){}function H(e){e=e.split(".");return e[0]+"."+e[1]}function z(r){var i,o=p.runtime.getManifest(),a=o.version,e=o.browser_action||o.action,t=e&&e.default_popup,e=(r.origin||"https://apps.jeurissen.co")+"/"+(r.websitePath||"")+"/",s=e+"installed",n=e+"whatsnew?installed=1",c=g&&r.updateBadge,u=864e5*(r.passiveActionButton?1.5:4.5);function l(){i&&(i=null,w(n),p.storage.local.remove("cj_landing_lastupdated"),r.onExecute&&r.onExecute(),c)&&(g.onClicked.removeListener(l),t&&S(),!0===c)&&g.setBadgeText({text:""})}function f(){var t,n,e,r="cj_landing_update_notification";t=r,n={requireInteraction:!0,type:"basic",iconUrl:(e=(e=o).icons)?e[160]||e[80]||e[128]||e[48]||e[Object.keys(e)[0]]:null,message:P("cj_i18n_06287","Click to view changelog"),title:P("cj_i18n_06288","{APP_NAME} has been updated").replace("{APP_NAME}",o.name)},b(t,n).catch(function(e){e=e&&e.message||"";if("requireInteraction"in n&&-1!==e.indexOf("requireInteraction"))return delete n.requireInteraction,b(t,n)}),p.notifications.onClicked.addListener(function(e){e===r&&(l(),p.notifications.clear(r))})}function _(){c&&(t&&h(""),!0===c)&&(g.setBadgeBackgroundColor({color:"#EA4335"}),g.setBadgeText({text:m?"*":"âœµ"})),r.onUpdateAvailable&&r.onUpdateAvailable()}function d(){function e(){l(),p.windows&&p.windows.onFocusChanged.removeListener(e),p.tabs&&p.tabs.onCreated.removeListener(e)}p.windows&&p.windows.onFocusChanged.addListener(e),p.tabs&&p.tabs.onCreated.addListener(e)}p.runtime.setUninstallURL(e+"uninstalled"),p.storage.local.get(["cj_landing_lastupdated","cj_landing_versionnumber"],function(e){var t,n=Date.now();i=e.cj_landing_lastupdated,"string"!=typeof(e=e.cj_landing_versionnumber)?w(s):i||(t=H(e),H(a)!==t&&(i=n,p.storage.local.set({cj_landing_lastupdated:n}))),i&&!r.noUpdateNotice&&(r.useNotification&&p.notifications?f():(!c||(t=n,_(),u<t-i))&&d(),r.handleTrigger)&&p.runtime.onMessage.addListener(function e(t,n){return n.id===p.runtime.id&&"cjeLandingOpen"===(t&&t.method)&&(l(),p.runtime.onMessage.removeListener(e)),!1}),e!==a&&p.storage.local.set({cj_landing_versionnumber:a})}),g&&g.onClicked.addListener(l),p.runtime.onStartup.addListener(D),p.runtime.onInstalled.addListener(D)}var x="sync",j="local",T="get",G="set",J="remove",K="clear",Q="getBytesInUse",O=null,A="__sync_storage__",k="__sync_fallback__",X="_info",Y=p.storage;function B(e,a,s){return new Promise(function(n,r){function t(e,t){a===T?n(e||{}):(t=t||p.runtime.lastError||a===Q&&"number"!=typeof e&&new Error("Received invalid value"))?r(t):n(e)}var i=Y[e],o=s||O;try{a===K?i[a](t):i[a](o,t)}catch(e){(a===K?i[a]():i[a](o)).then(t,function(e){t(O,e)})}})}function Z(e,t,n){for(var r,i=[],o=Object.keys(n),a=0;a<o.length;a++){var s=o[a];(r=s)===k||r===X||r.startsWith(A)||r.startsWith("cj_landing_")||t(s)&&i.push(s)}0<i.length&&B(e,J,i)}function $(r,i,o){B(r,T,O).then(function(e){var t={},n=o(i,e,t);if(r!==x||n)return(n?B(r,G,t):Promise.resolve()).then(function(){return Z(r,i,e)})})}var ee={bm_pref__applauncher__clicks:"bm_stats__applauncher__clicks",bm_pref__atari__filter:"bm_pref__sites__filter",bm_pref__atari__order:"bm_pref__sites__order",bm_pref__atari__thumbs:"bm_pref__sites__thumbs","dense-mode":"bm_pref__main__densemode","news-edition":"bm_pref__news__edition",prefDriveThumbnailView:"bm_pref__drive__thumbs",prefTasksDueDate:"bm_pref__tasks__duedate",prefTrendsHottrendsEdition:"bm_pref__trends__edition",prefatariFilterBy:"bm_pref__sites__filter",prefatariOrderBy:"bm_pref__sites__order",prefatariThumbnailView:"bm_pref__sites__thumbs",prefdatastudioFilterBy:"bm_pref__datastudio__filter",prefdatastudioOrderBy:"bm_pref__datastudio__order",prefdocsFilterBy:"bm_pref__docs__filter",prefdocsOrderBy:"bm_pref__docs__order",prefdocsThumbnailView:"bm_pref__docs__thumbs",prefdrawingsFilterBy:"bm_pref__drawings__filter",prefdrawingsOrderBy:"bm_pref__drawings__order",prefdrawingsThumbnailView:"bm_pref__drawings__thumbs",prefformsFilterBy:"bm_pref__forms__filter",prefformsOrderBy:"bm_pref__forms__order",prefformsThumbnailView:"bm_pref__forms__thumbs",prefjamboardFilterBy:"bm_pref__jamboard__filter",prefjamboardOrderBy:"bm_pref__jamboard__order",prefjamboardThumbnailView:"bm_pref__jamboard__thumbs",prefmymapsFilterBy:"bm_pref__mymaps__filter",prefmymapsOrderBy:"bm_pref__mymaps__order",prefmymapsThumbnailView:"bm_pref__mymaps__thumbs",prefscriptFilterBy:"bm_pref__script__filter",prefscriptOrderBy:"bm_pref__script__order",prefsheetsFilterBy:"bm_pref__sheets__filter",prefsheetsOrderBy:"bm_pref__sheets__order",prefsheetsThumbnailView:"bm_pref__sheets__thumbs",prefslidesFilterBy:"bm_pref__slides__filter",prefslidesOrderBy:"bm_pref__slides__order",prefslidesThumbnailView:"bm_pref__slides__thumbs","selected-services":"bm_pref__portal__services",serviceClicks:"bm_stats__applauncher__clicks"};function te(e,t,n){for(var r=n||t,i=!1,o=Object.keys(ee),a=0;a<o.length;a++){var s=o[a],c=t[s];void 0===c||e(s=ee[s])||void 0===t[s]&&(r[s]=c,i=!0)}return i}function ne(){(Y[x]?B(j,T,k).then(function(e){if(e[k])return Promise.all([B(j,T,O),B(x,T,O)]).then(function(e){for(var t=e[0],e=e[0],n={},r=Object.keys(t),i=Object.keys(e),o=[k],a=0;a<r.length;a++){var s,c=r[a];c.startsWith(A)&&(o.push(c),s=c.replace(A,""),i.includes(s)||(n[s]=t[c]))}return B(x,G,n).then(function(){return B(j,J,o)})})}):Promise.resolve()).then(function(){function e(e){return e.includes("bm_cache_")?!e.endsWith("bm_cache_v32__bookmarks__bookmarks")&&(!e.includes("bm_cache_v36")||t):e.includes("bm_stats")?r:!e.includes("bm_pref")||n}var t,n,r;r=n=t=!1;$(j,e,te),p.storage[x]&&$(x,e,te)})}function re(e,t,n){var r;return w(p.runtime.getURL((r=p.runtime.getManifest()).options_page||(r.options_ui||{}).page||"/views/options.html"),e,t,n)}function ie(e,t,n){return e||t||m?re(e,t,n):new Promise(function(e,t){p.runtime.openOptionsPage(function(){(p.runtime.lastError?t:e)()})}).catch(function(){return re(e,t,n)})}var C=p.menus||p.contextMenus,oe=Boolean(C),I=[];function ae(o){return new Promise(function(r,i){function t(e){var t=e&&e.message||"",n=!1;"visible"in o&&-1!==t.indexOf("visible")&&(delete o.visible,n=!0),"icons"in o&&-1!==t.indexOf("icons")&&(delete o.icons,n=!0),n?r(ae(o)):-1===t.indexOf("duplicate")&&-1===t.indexOf("already exists")&&-1===t.indexOf("already contains")&&i(e)}try{C.create(o,function(){var e=p.runtime.lastError;e?t(e):r()})}catch(e){t(e)}})}function se(e){for(var t=0;t<e.length;t++){var n=e[t];n&&(ae(n),n=n.id,-1===I.indexOf(n))&&I.push(n)}}function ce(e,t){C&&0!==e.length&&(t=t,C.onClicked.hasListener(t)||C.onClicked.addListener(t),(t=p.runtime.onInstalled)&&p.runtime.onInstalled.addListener(function(){se(e)}),l||!t)&&se(e)}function ue(){return"open"in(p.sidePanel||"object"==typeof browser&&browser.sidebarAction||p.sidebarAction||"object"==typeof opr&&opr.sidebarAction||{})}var L,le=m||/^Mac|^iP/.test(navigator.platform);function fe(e){var t=e.modifiers||[];return ie(-1!==t.indexOf("Shift"),1===e.button||-1!==t.indexOf(le?"Command":"Ctrl")||null)}function E(e){return o(e).catch(function(){return w(e.url)})}function M(e){e=e||{};e.view="cm",e.tf="0",E({url:cjBasics.urlParams.attach("https://mail.google.com/mail",e),width:500,height:516,type:"panel"})}function _e(){var e=function(){var e=C.ContextType;if(!e)return p.browserAction?["browser_action"]:p.pageAction?["page_action"]:["action"];for(var t=[],n=["ACTION","BROWSER_ACTION","PAGE_ACTION"],r=0;r<n.length;r++){var i=e[n[r]];i&&t.push(i)}return t}();L={openInTab:{contexts:e,limitToPages:["extensionsettings"],title:P("cj_i18n_03702","Open in new tab"),onClick:function(){w(p.runtime.getURL("/views/app.html"))}},openInPanel:{contexts:e,limitToPages:["extensionsettings"],title:P("cj_i18n_07904","Open in pop-out window"),onClick:function(){setTimeout(function(){E({type:"panel",url:p.runtime.getURL("/views/app.html"),height:596,width:600,focused:!0})})}},openSidebar:{contexts:e,limitToPages:["extensionsettings"],title:P("cj_i18n_07905","Open sidebar"),onClick:function(){if(p.sidePanel)p.windows.getCurrent().then(function(e){e=e.id;return p.sidePanel.open({windowId:e})});else{try{return void browser.sidebarAction.open()}catch(e){}new Promise(function(e){(p.sidebarAction||opr.sidebarAction).open(e)})}}},openPreferences:{contexts:e,limitToPages:["extensionsettings"],title:P("cj_i18n_01440","Preferences"),onClick:fe},translateSelection:{contexts:["selection"],limitToPages:["translate"],icons:{16:"/images/services/translate_16dp.svg"},title:P("cj_i18n_01547","Translate text"),onClick:function(e){var t=navigator.languages||[navigator.language],t=(t=t[0]).startsWith("zh-")?t:t.startsWith("mni")?"mni-Mtei":t.split("-",1)[0];E({url:cjBasics.urlParams.attach("https://translate.google.com/",{op:"translate",sl:"auto",tl:t,text:e.selectionText}),width:500,height:516,type:"panel"})}},emailSelection:{contexts:["selection"],limitToPages:["gmail","inbox"],icons:{16:"/images/services/gmail_16dp.svg"},title:P("cj_i18n_01548","Mail this text"),onClick:function(e,t){t=e.pageUrl||t.url,e=e.selectionText;t&&(e+="\n\nSource: ".concat(t,"\n")),M({body:e})}},emailToSelection:{contexts:["selection"],limitToPages:["gmail","inbox"],icons:{16:"/images/services/gmail_16dp.svg"},title:P("cj_i18n_01549","Write mail to address"),onClick:function(e){M({to:e.selectionText})}},gmailThisPage:{contexts:["page"],limitToPages:["gmail","inbox"],icons:{16:"/images/services/gmail_16dp.svg"},title:P("cj_i18n_01552","Mail this page"),onClick:function(e,t){e=e.pageUrl||t.url||"";M({su:t.title||"",body:e})}},translateThisPage:{contexts:["page"],limitToPages:["translate"],icons:{16:"/images/services/translate_16dp.svg"},title:P("cj_i18n_07195","Translate this page"),onClick:function(e,t){e=e.pageUrl||(e=t)&&(e.pendingUrl||e.url)||"",e="https://translate.google.com/website?u="+encodeURIComponent(e);v(t.id,{url:e})}}}}function de(){var r=Object.keys(cjBasics.pages),e=Object.keys(L).filter(function(e){if("openPreferences"===e)return m||l;if("openSidebar"===e)return!f&&ue();var t=L[e].limitToPages;if(!Array.isArray(t))return!0;for(var n=0;n<t.length;n++)if(-1!==r.indexOf(t[n]))return!0;return!1}),t=null,n=e;if(C)for(var i=Array.isArray(t),o=Array.isArray(n),a=0;a<I.length;a++){var s=I[a],c=!(i&&-1!==t.indexOf(s)||o&&-1===n.indexOf(s));C.update(s,{visible:c})}}function pe(){oe&&(_e(),ce(Object.keys(L).map(function(e){var t=L[e],e={id:e,contexts:t.contexts||["page"],title:t.title};return t.icons&&(e.icons=t.icons),e}),function(e,t){L[e.menuItemId].onClick(e,t||{})}),de())}var me=m||/^Mac|^iP/.test(navigator.platform);function U(e){var t,e="/pages/wei_"+e+"/"+e+"-",n=l?".svg":".png";t={16:e+"16"+n,19:e+"19"+n,32:e+"32"+n,38:e+"38"+n},g.setIcon({path:t},function(){p.runtime.lastError&&g.setIcon({path:t[32]||t[16]})})}function be(e){var i=t+e;g.onClicked.addListener(function(e,t){var t=t||{},n=t.modifiers||[],r=-1!==n.indexOf("Shift")||null,t=1===t.button||-1!==n.indexOf(me?"Command":"Ctrl")||null;w(i,r,t)})}function ge(){var n;p.runtime.getManifest().chrome_url_overrides?(be("/views/newtab.html"),U("newtab")):"undefined"!=typeof getComputedStyle&&getComputedStyle(document.documentElement).getPropertyValue("--arc-palette-background")&&be("/views/app.html"),B(x,T,n="bm_pref__main__extensionicon").then(function(e){var t;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:B(j,T,[t=A+n,n]).then(function(e){return e[t]||e[n]})}).then(function(e){"gsa_nobg"===e&&U("gsa_nobg")})}function he(){p.sidePanel&&p.sidePanel.setOptions({enabled:!0,path:"/views/sidebar.html?page=portal"}),ne(),ge()}"undefined"!=typeof document&&(document.body.textContent=""),z({updateBadge:"custom",websitePath:"black-menu-for-google",onExecute:function(){U("blackmenu")},onUpdateAvailable:function(){U("blackmenubadge")}}),pe(),e=he,p.runtime.onStartup&&p.runtime.onInstalled?(p.runtime.onStartup.addListener(e),p.runtime.onInstalled.addListener(e)):e(),setTimeout(function(){u.reload()},4e7),p.runtime.onMessage.addListener(function(e,t,n){if(t.id===p.runtime.id){var s,c,r=e&&e.method;if("listAccounts"===r)return cjgApis.account.list(e.data).then(function(e){n({error:!1,response:e})},function(e){n({error:!0,response:e})}),!0;"createNewPopup"===r?(s=e.data,c=p.webRequest,o({type:"popup",url:s.requestUrl,height:600,width:600,left:s.leftPosition||300,top:s.topPosition||64}).then(function(e){var n=d(e&&e.tabs[0]),r=e&&e.id;function t(e){var t;if(!l)return t=(e=new URL(e.url)).hash||"#","signin"===s.method?t="#signin":"signout"===s.method&&(t="#signout"),e=u.origin+"/views/cjg-popup.html"+e.search+t,n!==_&&v(n,{url:e}),{redirectUrl:e}}function i(){p.tabs.onRemoved.removeListener(a),p.runtime.onMessage.removeListener(o),"object"==typeof c&&c.onBeforeRequest.removeListener(t)}function o(e,t){return t.id===p.runtime.id&&"closeAuthPopup"===(e&&e.method)&&(p.windows.remove(r),i()),!1}function a(e){e===n&&i()}p.runtime.onMessage.addListener(o),p.tabs.onRemoved.addListener(a),"object"==typeof c&&c.onBeforeRequest.addListener(t,{tabId:n,urls:[s.redirectUrl],types:["main_frame"]},["blocking"])})):"getCurrentTab"===r?(e=t.tab,n(e)):"openActionPopup"===r&&setTimeout(R)}return!1})}();