"use strict";!function(){function e(e,n){for(var t in n)N(e,t,{get:n[t],enumerable:!0})}var d=self,u=d.location,h="undefined"!=typeof chrome&&chrome||{},N=Object.defineProperty,T={},n=(e(T,{list:function(){return ie},missingAccountData:function(){return A},noAccountData:function(){return f},signin:function(){return ce},signout:function(){return se}}),h.runtime.getURL("PATH/").replace("/PATH/","")),g=n.startsWith("safari-web-extension://"),m=!g&&n.startsWith("moz-extension://");function o(){var e;try{e=h.i18n.getMessage("@@extension_id")}catch(e){}return e||n.split("://")[1]}var t="https://www.google.com",r="https://ogs.google.com",E=cjBasics.navigator.contentScriptsOnSearchBlockable?r:t,M=["https://news.google.com",t,r],D=o(),H={};function W(e){var o,n=H[e];return n||(o=e,n=new Promise(function(n,e){var t=!1,r=(setTimeout(function(){t||e(new Error("timeout"))},1250),cjce.createElement("basic-iframe",{hidden:!0,src:o+"/images/cjg-proxy/"+D+"_"+cjBasics.generateUniqueId()+"/",sandbox:"allow-same-origin allow-scripts",onBmMessage:function(e){"cjgProxyReady"===e&&(t=!0,n(r))}}));document.head.appendChild(r)}),H[e]=n)}function z(e,n){n&&n.endsWith(".google.com");var r=t||t,o=(cjBasics.webRequest.transformRequestHeadersWithDnr([e],[{header:"origin",operation:"set",value:r}],["xmlhttprequest"]),cjBasics.webRequest.addListener("onBeforeSendHeaders",function(e){for(var n=e.requestHeaders,t=0;t<n.length;++t)if("origin"===n[t].name.toLowerCase()){n.splice(t,1);break}return n.push({name:"Origin",value:r}),o.removeListener(),{requestHeaders:n}},{types:["xmlhttprequest"],urls:[e]},["blocking","requestHeaders","extraHeaders"]))}function i(n,t,e){if("undefined"==typeof document)return Promise.reject(new Error("Running in service worker"));e&&z(n,e);var r=-1!==M.indexOf(e)?e:E;return W(r).then(function(e){return e.cjceSendFrameRequest({method:"cjgOriginRequest",value:btoa(JSON.stringify({url:n,parameters:t}))},r).then(function(e){if(e.success)return e.response;throw e.response})})}function a(e,n,t){return z(e,t),cjBasics.ajax(e,n)}function G(e,n,t){return m||"undefined"==typeof document?a(e,n,t).catch(function(){return i(e,n,t)}):i(e,n,t).catch(function(){return a(e,n,t)})}var F=h.tabs&&h.tabs.TAB_ID_NONE||-1;function X(t,r,o){cjBasics.navigator.getCurrentTabIdRequest().then(function(e){var e=e===F||-1!==u.search.indexOf("environment=popup")||u.pathname.endsWith("/popup.html"),n=(n=(n=e)&&d.screenTop)||(0<(n=(d.height-600)/2)?Math.round(n):void 0),e=0<(e=(e=e)&&d.screenLeft)?e:0<(e=(d.width-600)/2)?Math.round(e):void 0;cjBasics.navigator.isMac&&e&&(e+=6),h.runtime.sendMessage({method:"createNewPopup",data:{leftPosition:e,method:o,redirectUrl:r,requestUrl:t,topPosition:n}})})}var r={},Z=(e(r,{getAccountsBackupCookie:function(){return p},getLoginEmail:function(){return V},getSapisId:function(){return K},setCookieWebRequest:function(){return v}}),"https://www.google.com"),J={groups:"groupsloginpref",play:"PLAY_ACTIVE_ACCOUNT",sites:"SITESM",store:"PLAY_ACTIVE_ACCOUNT"};function c(t,r){return new Promise(function(n){h.cookies.get({name:t,url:r},function(e){h.runtime.lastError&&"SAPISID"===t&&"https://www.google.com"===r?n(c("SAPISID","https://accounts.google.com")):n(e?e.value:null)})})}function Y(e){return!e||-1===(e=e.split("=")[1]).indexOf("@")?null:e}function V(e){return c(J[e],"https://"+e+".google.com").then(Y)}function K(){return c("SAPISID",Z)}function p(e){return m?new Promise(function(n){h.cookies.getAll({url:e},function(e){h.runtime.lastError||!Array.isArray(e)?n(""):(e=e.map(function(e){return e.name+"="+e.value}).join("; "),n(e))})}):Promise.resolve("")}function v(r,e,n){var o;m&&-1!==r.indexOf("SAPISID=")&&(o=cjBasics.webRequest.addListener("onBeforeSendHeaders",function(e){o.removeListener();for(var n=e.requestHeaders,t=0;t<n.length;t++)if("cookie"===n[t].name.toLowerCase())return;return cjBasics.webRequest.setHasFirefoxContentBlocking(!0),n.push({name:"Cookie",value:r}),{requestHeaders:n}},{types:[n?"sub_frame":"xmlhttprequest"],urls:[e]},["blocking","requestHeaders"]))}var Q="https://accounts.google.com",s="https://www.google.com",l=u.pathname,$="/views/background.html"===l||"/background.js"===l,f={displayName:cjBasics.lang.i18n("cj_i18n_02717","Not signed in"),authuser:"0",obfuscatedId:"ACCOUNT_ID_NONE",pageId:null,validSession:!1,onlyAccount:!0,onlyAccountOrPage:!0},A={displayName:cjBasics.lang.i18n("cj_i18n_06286","A Google user"),photoUrl:"/images/avatar.svg",authuser:"0",obfuscatedId:"me",pageId:null,validSession:!0,onlyAccount:!0,onlyAccountOrPage:!0};function ee(e){e=e.split(".postMessage",2)[1].split("www.google.com",1)[0],e=decodeURIComponent(e.replace(/\\x/g,"%").replace(/\\n/g,"")).slice(2,-14);return JSON.parse(e)}function ne(e){if(Array.isArray(e)&&Array.isArray(e[1]))return e[1].map(function(e){return{displayName:e[2],displayEmail:e[3],photoUrl:e[4],authuser:e[7]?e[7].toString():"0",pageId:e[8],validSession:0!==e[9]&&!1!==e[9],obfuscatedId:e[10],ownedBySelectedAccount:e[11]}});throw new TypeError("Invalid API response")}function y(e){return a(e,{method:"POST",credentials:"include",fetchAs:"json"},s)}function w(e){return cjBasics.ajax(e+"&origin="+encodeURIComponent(s),{credentials:"include",fetchAs:"text"}).then(ee)}function te(e){return i(e,{method:"POST",credentials:"include",fetchAs:"json"},s)}function re(e){e=e,(n=Math.floor(1e3*Math.random()))<100&&(n+=103),n=Q+"/ListAccounts?json=standard&source=ogb&md=1&cc=1&mn=1&mo=1&gpsia=1&fwput="+n,e&&(!1!==e.listPages&&(n+="&listPages=1"),e.authuser&&(n+="&authuser="+encodeURIComponent(e.authuser)),e.pageId)&&(n+="&pageId="+encodeURIComponent(e.pageId));var n,t=n;return m?p(t).then(function(e){return v(e,t),y(t).catch(function(){return v(e,t+"&origin="+encodeURIComponent(s)),w(t)}).catch(function(){return v(e,t),te(t)})}):(g?w(t).catch(function(){return y(t)}):y(t).catch(function(){return w(t)})).catch(function(){return te(t)})}function oe(n){var e;return!0!==navigator.onLine?Promise.reject():(e=re(n),$?e:e.catch(function(){return e=n,new Promise(function(t,r){h.runtime.sendMessage({method:"listAccounts",data:e},function(e){var n=e.error,e=e.response;(n?r:t)(e)})});var e}))}function ue(e){if(1===e.length)e[0].onlyAccount=!0,e[0].onlyAccountOrPage=!0;else if(1<e.length){for(var n,t=0;t<e.length;t++){if("0"!==e[t].authuser)return e;e[t].pageId||(n=e[t])}n&&(n.onlyAccount=!0)}return e}function ie(n){return oe(n).then(ne).then(ue).catch(function(){return null}).then(function(e){return n.includeFallback?Array.isArray(e)?[f]:[A]:e})}function ae(e,n,t){var r=o(),r=s+"/images/cjg-apis/"+r+"_"+cjBasics.generateUniqueId()+"/"+t,n=n||{};return n.continue=r,n.hl=cjBasics.lang.getCurrent(),X(cjBasics.urlParams.attach(Q+"/"+e,n),r+"*",t)}function ce(e){var n="AddSession";return ae(n=e&&!1===e.validSession?"AccountChooser":n,{Email:"string"==typeof(n=e&&e.displayEmail)&&-1!==n.indexOf("@")&&2<n.length?n:null},"signin")}function se(){ae("Logout",null,"signout")}var l={},j=(e(l,{getTokenInfo:function(){return he},requestPermissions:function(){return ye},requireToken:function(){return C},revokePermissions:function(){return Ae}}),"https://www.google.com"),b="https://accounts.google.com",le="https://oauth2.googleapis.com",fe="https://g.carlosjeurissen.com/webext-auth",I=d.atob("NDk0MDg2MDMwODUxLTkzdmplNzc4a29ncjlkbmZxMmhobGkyZTkxOHA0aGhhLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29t"),_=o(),P={},de={};function he(e){e=cjBasics.urlParams.attach(le+"/tokeninfo",{access_token:e,prettyPrint:"false"});return cjBasics.ajax(e,{fetchAs:"json"})}function S(e){return e.pageId?"https://www.googleapis.com/auth/youtube.readonly":"https://www.googleapis.com/auth/userinfo.profile"}function ge(e,n){return Promise.reject({cjg_error:"not_authorized",cjg_missing_scopes:n})}function me(e,n,t){var r,o;return n&&n.accessToken?(r=[],o=n.grantedScopes||[],t.forEach(function(e){-1===o.indexOf(e)&&r.push(e)}),0<r.length?ge(0,r):n.accessToken):ge(0,t)}function pe(e,s){var l=Boolean(h.webRequest),f=!l;return new Promise(function(t){var r,u,i=_+"---"+cjBasics.generateUniqueId(),a=document.createElement("iframe");function o(e,n){var o=function(e,n){if(!(n=n.split("#")[1]))return null;if(-1===n.indexOf("&"))try{n=d.atob(n)}catch(e){}return!(n=new URLSearchParams(n)).get("error")&&n.get("state")===e&&n.get("access_token")||null}(i,e);!o&&n?t(null):(a.remove(),r&&r.removeListener(),u&&u.removeListener(),f&&h.runtime.onMessage.removeListener(c),e=he(o).then(function(e){var n,t,r;return e.aud!==I?null:(n=e,t=Date.now(),n=(r=Number(n.expires_in))?t+r:(r=Number(n.exp))?1e3*r:t,r=e.scope?e.scope.split(" "):[],{accessToken:o,expireTime:n,grantedScopes:r})},function(){return null}),t(e))}function c(e,n){return n.id===h.runtime.id&&"cjgAuthUrl"===(e&&e.method)&&(n=e.data)&&(e=new URL(n)).origin===j&&(e.pathname.startsWith("/cjg-auth/")||e.pathname.startsWith("/images/cjg-auth/"))&&o(n,!0),!1}l&&(u=cjBasics.webRequest.addListener("onBeforeRedirect",function(e){o(e.redirectUrl)},{types:["sub_frame"],urls:[j+"/images/cjg-auth/"+_+"*",j+"/cjg-auth/"+_+"*",b+"/*"+_+"*"]}),r=cjBasics.webRequest.catchAndStop([j+"/images/cjg-auth/"+_+"*",j+"/cjg-auth/"+_+"*"],function(e){o(e)})),f&&(h.runtime.onMessage.addListener(c),g)&&d.addEventListener("message",function(e){e.origin===j&&(e=e.data)&&c({method:e.bm_method,data:e.bm_value})}),a.style.display="none";var n=cjBasics.urlParams.attach(b+"/o/oauth2/v2/auth",{authuser:e.authuser,client_id:I,include_granted_scopes:"true",pageId:e.pageId||null,prompt:"none",redirect_uri:fe,response_type:"token",scope:s,state:i});a.src=n,m?p(n).then(function(e){v(e,n,!0),setTimeout(function(){document.body.appendChild(a)})}):document.body.appendChild(a)})}function C(n,e){var t=e,r=n.pageId+"-"+n.obfuscatedId,e=(Array.isArray(t)&&0!==t.length||(t=[S(n)]),P[r]);if(e){if(e.expireTime>Date.now()+1e4)return me(0,e,t);P[r]=null}var o,u,e=de[r];return e||(o=t[0],u=S(n),e=pe(n,o).then(function(e){return e||o===u?e:pe(n,u)}),de[r]=e),e.then(function(e){return e&&(P[r]=e),me(0,e,t)})}function ve(e){return cjBasics.ajax(le+"/revoke",{fetchAs:"json",method:"POST",body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"}})}function Ae(e){return C(e).then(ve)}function ye(e,n){var t;e=e,n=n,n=Array.isArray(n)?n:[],t=S(e),-1===n.indexOf(t)&&n.push(t),X(cjBasics.urlParams.attach(b+"/o/oauth2/v2/auth",{authuser:e.authuser||"0",hl:cjBasics.lang.getCurrent(),client_id:I,login_hint:e.displayEmail,pageId:e.pageId||null,redirect_uri:fe,response_type:"token",scope:n.join(" "),state:_+"---permissionrequest"}),j+"/cjg-auth/"+_+"*","auth")}var we={},x=(e(we,{getItem:function(){return Be},remove:function(){return qe},setItem:function(){return Oe}}),"local"),je="get",be="set",Ie="remove",_e="clear",Pe="getBytesInUse",Se=null,Ce=h.storage;function k(e,i,a){return new Promise(function(t,r){function n(e,n){i===je?t(e||{}):(n=n||h.runtime.lastError||i===Pe&&"number"!=typeof e&&new Error("Received invalid value"))?r(n):t(e)}var o=Ce[e],u=a||Se;try{i===_e?o[i](n):o[i](u,n)}catch(e){(i===_e?o[i]():o[i](u)).then(n,function(e){n(Se,e)})}})}function xe(n){return k(x,je,n).then(function(e){return e[n]})}function ke(e,n){return t=x,(r={})[e]=n,k(t,be,r);var t,r}function B(e){return e.obfuscatedId+"-"+e.pageId+"-cjg"}function Be(e,n){return xe(B(e)+"-"+n)}function Oe(e,n,t){return ke(B(e)+"-"+n,t)}function qe(e,n){var t=B(e),e=Array.isArray(n)?n.map(function(e){return t+"-"+e}):t+"-"+n;return k(x,Ie,e)}var Le={};e(Le,{getIsAdmin:function(){return Ne},getIsConsumerGmail:function(){return Re},getIsOne:function(){return Te},getSource:function(){return q},getUserDomain:function(){return Ue}});var O={};function q(e){var n,t,r=e.pageId+"-"+e.authuser;return O[r]||(O[r]=(e="https://myaccount.google.com"+(t="",(e=e=e)&&((n=e.authuser)&&"0"!==n&&(t+="/u/"+n),n=e.pageId)&&(t+="/b/"+n),t)+"/?hl=en",cjBasics.ajax(e,{fetchAs:"text"}))),O[r]}function Re(e){e=e.displayEmail;return e?e.endsWith("@gmail.com")||e.endsWith("@googlemail.com"):null}function Ue(e){return!e.validSession||Re(e)?Promise.resolve(null):q(e).then(function(e){var n,e=(e=e).replace("domainName\\u003d","domainName=");if(-1!==e.indexOf("domainName=")&&4<(n=e.split("domainName=",2)[1].split('"',1)[0]).length&&n.length<200&&"gmail.com"!==n&&"googlemail.com"!==n)return n;if(-1!==e.indexOf("managed by"))n=e.split("managed by")[1];else{if(-1===e.indexOf("gbpbt"))return null;n=e.split("gbpbt")[1]}return(n=n.split("<b>")[1].split("<")[0]).length<200?n:null},function(){return null})}function Ne(e){return!e.validSession||Re(e)?Promise.resolve(null):q(e).then(function(e){return-1!==e.indexOf('data-pid="199"')||-1!==e.indexOf("https://admin.google.com")})}function Te(n){var t;return n.validSession?(t=q(n).then(function(e){return-1!==e.indexOf("M4.02,28.27C2.73,25.8,2,22.98,2,20c0-2.87,0.68-5.59,1.88-8l-1.72-1.04C0.78,13.67,0,16.75,0,20c0,3.31,0.8,6.43,2.23,9.18L4.02,28.27z")}).then(function(e){return Oe(n,"bm_cache_v36__account__one",e),e}),Be(n,"bm_cache_v36__account__one").then(function(e){return"boolean"==typeof e?e:t})):Promise.resolve(!1)}var Ee,Me={},De=(e(Me,{changeAccount:function(){return L},getAccountsList:function(){return ze},getCurrentAccountFromCache:function(){return We},init:function(){return Ge},resetCache:function(){return He}}),new Promise(function(e){Ee=e}));function He(){De=new Promise(function(e){Ee=e})}function We(){return xe("bm_pref__account__current").then(function(e){return e||A})}function L(e,n){return"function"==typeof n&&n(e),ke("bm_pref__account__current",e).then(function(){n||g||cjBasics.reloadAll(!0)})}function ze(){return De}function Ge(o){return We().then(function(r){return ie({authuser:r.authuser}).then(function(e){if(Ee(e),Array.isArray(e))if(0===e.length||!e[0].validSession)r.obfuscatedId!==f.obfuscatedId&&L(f);else{for(var n=0;n<e.length;n++){var t=e[n];if(r.obfuscatedId===t.obfuscatedId&&r.pageId===t.pageId)return t.validSession?r.validSession&&r.displayEmail===t.displayEmail&&r.authuser===t.authuser?void((r.photoUrl!==t.photoUrl||r.displayName!==t.displayName||r.onlyAccount!==t.onlyAccount||r.onlyAccountOrPage!==t.onlyAccountOrPage)&&L(t,o||!0)):void L(t):void L(e[0])}L(e[0])}}),r})}function R(e){for(var n="",t=7;0<=t;t--)n+=(e>>>4*t&15).toString(16);return n}function U(e,n){return e<<n|e>>>32-n}var Fe="https://www.google.com";function Xe(t){return K().then(function(e){var n=Math.floor(Date.now()/1e3),e=[n,e,t||Fe].join(" ");return"SAPISIDHASH "+n+"_"+function(e){for(var n,t,r,o,u,i,a,c,s=Array.from({length:80}),l=1732584193,f=4023233417,d=2562383102,h=271733878,g=3285377520,m=(e=unescape(encodeURIComponent(e))).length,p=[],v=0;v<m-3;v+=4)t=e.charCodeAt(v)<<24|e.charCodeAt(v+1)<<16|e.charCodeAt(v+2)<<8|e.charCodeAt(v+3),p.push(t);switch(m%4){case 0:v=2147483648;break;case 1:v=e.charCodeAt(m-1)<<24|8388608;break;case 2:v=e.charCodeAt(m-2)<<24|e.charCodeAt(m-1)<<16|32768;break;case 3:v=e.charCodeAt(m-3)<<24|e.charCodeAt(m-2)<<16|e.charCodeAt(m-1)<<8|128}for(p.push(v);p.length%16!=14;)p.push(0);for(p.push(m>>>29,m<<3&4294967295),n=0;n<p.length;n+=16){for(v=0;v<16;v++)s[v]=p[n+v];for(v=16;v<=79;v++)s[v]=U(s[v-3]^s[v-8]^s[v-14]^s[v-16],1);for(r=l,o=f,u=d,i=h,a=g,v=0;v<=19;v++)c=U(r,5)+(o&u|~o&i)+a+s[v]+1518500249&4294967295,a=i,i=u,u=U(o,30),o=r,r=c;for(v=20;v<=39;v++)c=U(r,5)+(o^u^i)+a+s[v]+1859775393&4294967295,a=i,i=u,u=U(o,30),o=r,r=c;for(v=40;v<=59;v++)c=U(r,5)+(o&u|o&i|u&i)+a+s[v]+2400959708&4294967295,a=i,i=u,u=U(o,30),o=r,r=c;for(v=60;v<=79;v++)c=U(r,5)+(o^u^i)+a+s[v]+3395469782&4294967295,a=i,i=u,u=U(o,30),o=r,r=c;l=l+r&4294967295,f=f+o&4294967295,d=d+u&4294967295,h=h+i&4294967295,g=g+a&4294967295}return(c=R(l)+R(f)+R(d)+R(h)+R(g)).toLowerCase()}(e)})}function Ze(o,u,i){var a=Fe;return Xe(a).then(function(e){var n=new URL(o),t=n.hostname,t=(n.hostname="content.googleapis.com"===t||"www.googleapis.com"===t||"www.google.com"===t?"clients6.google.com":t.replace("googleapis.com","clients6.google.com"),i.account),r=(u.credentials="include",u.headers||{}),e=(r.Authorization=e,r["X-Goog-AuthUser"]=t.authuser,t.pageId&&(r["X-Goog-PageId"]=t.pageId),i.key);return"string"==typeof e&&((t=new URLSearchParams(n.search)).set("key",e),n.search=t,r["X-Goog-Api-Key"]=e),u.headers=r,G(n.href,u,a)})}function Je(e,n,t){return Ze(e,n,t).catch(function(){return Ze(e,n,t)})}d.cjgApis={account:T,auth:l,cache:we,info:Le,login:r,originRequest:G,request:function(n,t,e){var r,o=e||{},u=(o.account,o.account=o.account||A,t||{}),i=o.pa;return!0===i?Je(n,u,o):(r="optional"===i&&!0,C(e.account,e.requiredScopes).then(function(e){return t.headers=t.headers||{},t.headers.Authorization="Bearer "+e,cjBasics.ajax(n,t)},function(e){if(r)return Je(n,u,o).catch(function(){throw e});throw e}))},session:Me}}();